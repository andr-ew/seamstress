#include "device_monitor_macos.h"

#include <CoreFoundation/CoreFoundation.h>
#include <IOKit/IOKitLib.h>
#include <IOKit/usb/IOUSBLib.h>
#include <IOKit/serial/IOSerialKeys.h>

typedef struct {
  IONotificationPortRef notify;
  io_iterator_t iter;
} notify_state_t;

static notify_state_t *state;

void dev_monitor_deinit(void) {
  
}

void dev_monitor_init(void) {
  CFMutableDictionaryRef matching;

  if (!(state->notify = IONotificationPortCreate((mach_port_t) 0))) {
    fprintf(stderr, "dev_monitor_init(): couldn't allocate notification port!\n");
    return;
  }

  CFRunLoopAddSource(CFRunLoopGetCurrent(),
                     IONotificationPortGetRunLoopSource(state->notify),
                     kCFRunLoopDefaultMode);

  matching = IOServiceMatching(kIOSerialBSDServiceValue);

}

void dev_monitor_scan(void) {
  
}
